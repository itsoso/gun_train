<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦å‘˜è®­ç»ƒç»ˆç«¯ - æ™ºèƒ½æªæ¢°è®­ç»ƒç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 90%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .student-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 20px;
            font-weight: bold;
        }

        .score-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: inline-flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .score-value {
            font-size: 64px;
            font-weight: bold;
        }

        .score-label {
            font-size: 18px;
            margin-top: 10px;
        }

        .sub-scores {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .sub-score-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .sub-score-title {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .sub-score-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .errors-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .errors-title {
            color: #856404;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .error-item {
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .error-icon {
            width: 30px;
            height: 30px;
            background: #ffc107;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-weight: bold;
            color: white;
        }

        .error-text {
            flex: 1;
            color: #333;
        }

        .progress-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .progress-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .status-training {
            background: #ffc107;
            color: white;
        }

        .status-passed {
            background: #28a745;
            color: white;
        }

        .critical-warning {
            background: #dc3545;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ æ™ºèƒ½æªæ¢°è®­ç»ƒç³»ç»Ÿ</h1>
            <p>å­¦å‘˜è®­ç»ƒç»ˆç«¯</p>
        </div>

        <div class="student-info">
            <div class="info-item">
                <div class="info-label">å­¦å‘˜å§“å</div>
                <div class="info-value" id="studentName">å¼ ä¸‰</div>
            </div>
            <div class="info-item">
                <div class="info-label">è­¦å·</div>
                <div class="info-value" id="badgeNumber">001001</div>
            </div>
            <div class="info-item">
                <div class="info-label">å·¥ä½</div>
                <div class="info-value" id="workstation">01å·</div>
            </div>
            <div class="info-item">
                <div class="info-label">è®­ç»ƒçŠ¶æ€</div>
                <div class="info-value">
                    <span class="status-badge status-training" id="status">è®­ç»ƒä¸­</span>
                </div>
            </div>
        </div>

        <!-- å±é™©è­¦å‘Šï¼ˆåŠ¨æ€æ˜¾ç¤ºï¼‰ -->
        <div id="criticalWarning" style="display: none;" class="critical-warning">
            âš ï¸ å±é™©ï¼æªå£æŒ‡å‘éå®‰å…¨åŒºåŸŸï¼
        </div>

        <div class="score-display">
            <div class="score-circle">
                <div class="score-value" id="overallScore">78</div>
                <div class="score-label">å½“å‰å¾—åˆ†</div>
            </div>
        </div>

        <div class="sub-scores">
            <div class="sub-score-card">
                <div class="sub-score-title">æŒæªå§¿åŠ¿</div>
                <div class="sub-score-value" id="postureScore">75</div>
            </div>
            <div class="sub-score-card">
                <div class="sub-score-title">æ‰³æœºçºªå¾‹</div>
                <div class="sub-score-value" id="triggerScore">85</div>
            </div>
            <div class="sub-score-card">
                <div class="sub-score-title">ç„å‡†çº¿</div>
                <div class="sub-score-value" id="aimScore">72</div>
            </div>
            <div class="sub-score-card">
                <div class="sub-score-title">ç¨³å®šæ€§</div>
                <div class="sub-score-value" id="stabilityScore">80</div>
            </div>
        </div>

        <div class="errors-section" id="errorsSection">
            <div class="errors-title">âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼š</div>
            <div class="error-item">
                <div class="error-icon">!</div>
                <div class="error-text">å³è‚˜è§’åº¦è¿‡å¤§(125Â°)ï¼Œåº”ä¿æŒåœ¨90-120Â°</div>
            </div>
            <div class="error-item">
                <div class="error-icon">!</div>
                <div class="error-text">å¤´éƒ¨ä½ç½®è¿‡ä½ï¼Œæ— æ³•å½¢æˆæ­£ç¡®çš„ç„å‡†çº¿</div>
            </div>
            <div class="error-item">
                <div class="error-icon">!</div>
                <div class="error-text">æ‰‹éƒ¨è½»å¾®æŠ–åŠ¨ï¼Œå»ºè®®åŠ å¼ºç¨³å®šæ€§è®­ç»ƒ</div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-title">è®­ç»ƒè¿›åº¦ - ç©ºæªè®­ç»ƒé˜¶æ®µ</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 60%;">
                    3 / 5 æ¬¡åˆæ ¼
                </div>
            </div>
            <p style="color: #666; font-size: 14px; margin-top: 10px;">
                ç»§ç»­ä¿æŒï¼è¿ç»­5æ¬¡è¾¾æ ‡åå³å¯è¿›å…¥å®å¼¹è®­ç»ƒ
            </p>
        </div>
    </div>

    <script>
        // WebSocketè¿æ¥
        const ws = new WebSocket('ws://localhost:8000/ws/student/1/workstation/1');

        ws.onopen = () => {
            console.log('âœ… WebSocketè¿æ¥æˆåŠŸ');
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            console.log('æ”¶åˆ°æ¶ˆæ¯:', data);

            if (data.type === 'real_time_analysis') {
                updateScores(data.data);
            } else if (data.type === 'warning' && data.data.warning_level === 'critical') {
                showCriticalWarning(data.data.description);
            }
        };

        ws.onerror = (error) => {
            console.error('âŒ WebSocketé”™è¯¯:', error);
        };

        ws.onclose = () => {
            console.log('WebSocketè¿æ¥å…³é—­ï¼Œå°è¯•é‡è¿...');
            setTimeout(() => location.reload(), 3000);
        };

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScores(data) {
            document.getElementById('overallScore').textContent = Math.round(data.overall_score);
            document.getElementById('postureScore').textContent = Math.round(data.posture_score);
            document.getElementById('triggerScore').textContent = Math.round(data.trigger_discipline_score);
            document.getElementById('aimScore').textContent = Math.round(data.aim_line_score);
            document.getElementById('stabilityScore').textContent = Math.round(data.stability_score);

            // æ›´æ–°é”™è¯¯åˆ—è¡¨
            if (data.errors && data.errors.length > 0) {
                const errorsHtml = data.errors.map(error => `
                    <div class="error-item">
                        <div class="error-icon">!</div>
                        <div class="error-text">${error.description}</div>
                    </div>
                `).join('');

                document.querySelector('#errorsSection').innerHTML = `
                    <div class="errors-title">âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼š</div>
                    ${errorsHtml}
                `;
            }
        }

        // æ˜¾ç¤ºä¸¥é‡è­¦å‘Š
        function showCriticalWarning(message) {
            const warningDiv = document.getElementById('criticalWarning');
            warningDiv.textContent = `âš ï¸ ${message}`;
            warningDiv.style.display = 'block';

            // æ’­æ”¾è­¦å‘ŠéŸ³
            // const audio = new Audio('/sounds/warning.mp3');
            // audio.play();

            // 3ç§’åéšè—
            setTimeout(() => {
                warningDiv.style.display = 'none';
            }, 3000);
        }

        // æ¨¡æ‹Ÿæ•°æ®æ›´æ–°ï¼ˆå®é™…ç”±WebSocketæ¨é€ï¼‰
        setInterval(() => {
            // è¿™é‡Œä»…ä½œæ¼”ç¤ºï¼Œå®é™…æ•°æ®ç”±åç«¯æ¨é€
            const simulatedData = {
                overall_score: 70 + Math.random() * 20,
                posture_score: 70 + Math.random() * 20,
                trigger_discipline_score: 70 + Math.random() * 20,
                aim_line_score: 70 + Math.random() * 20,
                stability_score: 70 + Math.random() * 20,
                errors: []
            };
            // updateScores(simulatedData);
        }, 2000);
    </script>
</body>
</html>

